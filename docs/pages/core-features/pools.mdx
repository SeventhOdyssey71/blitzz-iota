# Liquidity Pools

Liquidity pools are the backbone of IOTA DeFi, enabling instant swaps and earning opportunities for liquidity providers.

## Understanding Liquidity Pools

### What are Liquidity Pools?

Liquidity pools are smart contracts that hold reserves of two tokens. These reserves enable:

- **Instant Trading**: Users can swap between tokens without waiting for buyers/sellers
- **Price Discovery**: Automatic pricing based on pool ratios
- **Earning Opportunities**: LPs earn fees from every trade

<div style={{
  background: 'linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(0, 128, 255, 0.1) 100%)',
  border: '1px solid rgba(0, 255, 255, 0.3)',
  borderRadius: '12px',
  padding: '24px',
  marginTop: '24px',
  marginBottom: '24px'
}}>
  <h3 style={{ marginTop: 0, color: '#00ffff' }}>Pool Economics</h3>
  <p>Each pool maintains a constant product: <code>x * y = k</code></p>
  <p>Where x and y are the token reserves, and k remains constant during swaps</p>
</div>

## Providing Liquidity

### Benefits of Being an LP

1. **Trading Fees**: Earn 0.25% of all trades
2. **LP Tokens**: Receive tokens representing your share
3. **Additional Rewards**: Potential farming incentives
4. **Compound Growth**: Fees auto-compound in the pool

### How to Add Liquidity

```typescript
// Step-by-step process
1. Select a pool or create new one
2. Enter amounts for both tokens
3. Review pool share and rates
4. Approve token spending
5. Confirm liquidity addition
```

### Initial Liquidity

When creating a new pool:

<div style={{
  background: 'rgba(10, 10, 10, 0.8)',
  border: '1px solid rgba(255, 255, 255, 0.1)',
  borderRadius: '8px',
  padding: '20px',
  marginTop: '16px',
  marginBottom: '16px'
}}>
  <h4 style={{ marginTop: 0, color: '#00ffff' }}>Setting Initial Price</h4>
  
  The ratio of tokens you provide sets the initial price:
  - 100 IOTA + 1000 USDC = 1 IOTA = 10 USDC
  - 50 IOTA + 100 stIOTA = 1 IOTA = 2 stIOTA
  
  <strong>‚ö†Ô∏è Important:</strong> Set prices carefully to avoid arbitrage losses
</div>

## Pool Management

### Your Positions

Track your liquidity positions with:

- **Pool Share**: Your percentage of total liquidity
- **Token Amounts**: Current value of each token
- **Earned Fees**: Accumulated trading fees
- **IL Status**: Impermanent loss calculation

### Adding More Liquidity

You can add liquidity anytime:

1. Maintains your current pool ratio
2. Increases your pool share
3. No need to withdraw first
4. Gas-efficient single transaction

### Removing Liquidity

Withdraw your liquidity by:

1. Selecting the position
2. Choosing withdrawal percentage
3. Reviewing token amounts
4. Confirming withdrawal

<div style={{
  background: 'rgba(0, 255, 255, 0.1)',
  border: '1px solid rgba(0, 255, 255, 0.3)',
  borderRadius: '8px',
  padding: '16px',
  marginTop: '16px',
  marginBottom: '16px'
}}>
  <strong>üí° Note:</strong> You receive both tokens proportional to current pool ratio, not your initial deposit ratio
</div>

## Understanding Impermanent Loss

### What is Impermanent Loss?

IL occurs when token price ratios change from your deposit time:

```javascript
// Example scenario
Initial: 1 IOTA = $10, 1 stIOTA = $10
Deposit: 10 IOTA + 10 stIOTA = $200

Later: 1 IOTA = $20, 1 stIOTA = $10
Pool value: ~$282.84
Hold value: $300
IL = $17.16 (5.72%)
```

### IL Calculator

| Price Change | IL % |
|--------------|------|
| 1.25x | 0.6% |
| 1.5x | 2.0% |
| 2x | 5.7% |
| 3x | 13.4% |
| 4x | 20.0% |
| 5x | 25.5% |

### Mitigating IL

Strategies to reduce IL impact:

1. **Stable Pairs**: USDC/USDT have minimal IL
2. **Correlated Assets**: IOTA/stIOTA move together
3. **Fee Compensation**: High-volume pools offset IL
4. **Strategic Timing**: Add liquidity during low volatility

## Pool Analytics

### Key Metrics

Monitor pool performance with:

<div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px', marginTop: '16px' }}>
  <div style={{
    background: 'rgba(10, 10, 10, 0.8)',
    border: '1px solid rgba(255, 255, 255, 0.1)',
    borderRadius: '8px',
    padding: '16px'
  }}>
    <h4 style={{ marginTop: 0, color: '#00ffff' }}>TVL</h4>
    <p>Total Value Locked in the pool</p>
  </div>
  
  <div style={{
    background: 'rgba(10, 10, 10, 0.8)',
    border: '1px solid rgba(255, 255, 255, 0.1)',
    borderRadius: '8px',
    padding: '16px'
  }}>
    <h4 style={{ marginTop: 0, color: '#00ffff' }}>Volume 24h</h4>
    <p>Trading volume in last 24 hours</p>
  </div>
  
  <div style={{
    background: 'rgba(10, 10, 10, 0.8)',
    border: '1px solid rgba(255, 255, 255, 0.1)',
    borderRadius: '8px',
    padding: '16px'
  }}>
    <h4 style={{ marginTop: 0, color: '#00ffff' }}>APR</h4>
    <p>Annual percentage rate from fees</p>
  </div>
  
  <div style={{
    background: 'rgba(10, 10, 10, 0.8)',
    border: '1px solid rgba(255, 255, 255, 0.1)',
    borderRadius: '8px',
    padding: '16px'
  }}>
    <h4 style={{ marginTop: 0, color: '#00ffff' }}>Fee Tier</h4>
    <p>Percentage fee for swaps</p>
  </div>
</div>

### APR Calculation

```typescript
// Simple APR formula
dailyVolume = $100,000
poolTVL = $1,000,000
feeRate = 0.25%

dailyFees = dailyVolume * feeRate = $250
dailyAPR = (dailyFees / poolTVL) * 100 = 0.025%
annualAPR = dailyAPR * 365 = 9.125%
```

## Advanced Strategies

### Concentrated Liquidity

Future feature for capital efficiency:

- Provide liquidity in specific price ranges
- Higher fee earnings within range
- Requires active management
- Better for stable pairs

### LP Farming

Earn additional rewards:

1. **Dual Rewards**: Fees + farm tokens
2. **Boosted APRs**: Often 20-100%+ APR
3. **Time Locks**: Some farms have vesting
4. **Risk/Reward**: Higher APR = higher risk

### Portfolio Rebalancing

Use pools for automatic rebalancing:

<div style={{
  background: 'rgba(10, 10, 10, 0.8)',
  border: '1px solid rgba(255, 255, 255, 0.1)',
  borderRadius: '8px',
  padding: '20px',
  marginTop: '16px',
  marginBottom: '16px'
}}>
  <h4 style={{ marginTop: 0, color: '#00ffff' }}>50/50 Rebalancing</h4>
  
  Pools naturally maintain 50/50 value ratio:
  - Token A rises ‚Üí Pool sells some A for B
  - Token B rises ‚Üí Pool sells some B for A
  - Always maintains equal value
</div>

## Risk Management

### Pool Risks

Understanding risks involved:

1. **Impermanent Loss**: Price divergence risk
2. **Smart Contract Risk**: Code vulnerabilities
3. **Rug Pull Risk**: Malicious token creators
4. **Low Liquidity**: High slippage on exit

### Safety Checklist

Before providing liquidity:

- ‚úÖ Verify token contracts
- ‚úÖ Check pool TVL and volume
- ‚úÖ Understand IL implications
- ‚úÖ Review historical APRs
- ‚úÖ Start with small amounts

## API Integration

### Pool Data Access

```typescript
import { PoolSDK } from '@iota-defi/sdk';

const sdk = new PoolSDK({ network: 'mainnet' });

// Get pool info
const pool = await sdk.getPool('IOTA', 'stIOTA');
console.log({
  tvl: pool.tvl,
  volume24h: pool.volume24h,
  apr: pool.apr,
  reserves: pool.reserves
});

// Add liquidity
const tx = await sdk.addLiquidity({
  tokenA: 'IOTA',
  tokenB: 'stIOTA',
  amountA: '100',
  amountB: '200',
  slippage: 0.5
});
```

### Monitoring Positions

```typescript
// Get LP positions
const positions = await sdk.getPositions(userAddress);

// Calculate IL
const il = await sdk.calculateIL({
  position: positions[0],
  currentPrices: await sdk.getCurrentPrices()
});
```

## Best Practices

<div style={{
  background: 'rgba(255, 193, 7, 0.1)',
  border: '1px solid rgba(255, 193, 7, 0.3)',
  borderRadius: '8px',
  padding: '16px',
  marginTop: '16px',
  marginBottom: '16px'
}}>
  <strong>üèä LP Best Practices:</strong>
  
  1. **Diversify**: Don't put all funds in one pool
  2. **Monitor Regularly**: Check IL and APRs
  3. **Understand Risks**: IL can exceed fee earnings
  4. **Choose Wisely**: Stable pairs for safety, volatile for returns
  5. **Time Entry/Exit**: Consider market conditions
</div>

## Troubleshooting

### Common Issues

**"Price Impact Too High"**
- Pool has low liquidity
- Try smaller amounts
- Wait for more LPs

**"Insufficient Liquidity"**
- One token reserve too low
- Pool imbalanced
- Try different amounts

**"Slippage Exceeded"**
- Price moved during transaction
- Increase slippage tolerance
- Try again quickly

## Next Steps

- [Explore limit orders ‚Üí](/core-features/limit-orders)
- [Learn about DCA strategies ‚Üí](/core-features/dca)
- [View pool analytics ‚Üí](/core-features/analytics)
- [Read smart contract docs ‚Üí](/smart-contracts/dex)