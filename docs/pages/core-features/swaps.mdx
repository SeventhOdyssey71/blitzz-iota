# Swaps

IOTA DeFi's swap feature provides instant token exchanges with optimal pricing through our advanced AMM (Automated Market Maker) protocol.

## How Swaps Work

Our swap mechanism uses a constant product formula (x * y = k) to maintain liquidity and determine exchange rates. This ensures:

- **Instant Execution**: Trades execute immediately without waiting for counterparties
- **Fair Pricing**: Prices adjust automatically based on supply and demand
- **Deep Liquidity**: Access to pooled liquidity from all providers

<div style={{
  background: 'rgba(10, 10, 10, 0.8)',
  border: '1px solid rgba(0, 255, 255, 0.2)',
  borderRadius: '8px',
  padding: '20px',
  marginTop: '16px',
  marginBottom: '16px'
}}>
  <h3 style={{ marginTop: 0, color: '#00ffff' }}>Swap Flow</h3>
  <ol style={{ marginBottom: 0 }}>
    <li>Select input and output tokens</li>
    <li>Enter swap amount</li>
    <li>Review exchange rate and fees</li>
    <li>Approve and execute transaction</li>
    <li>Receive tokens instantly</li>
  </ol>
</div>

## Swap Interface

### Basic Swap

The swap interface provides:

- **Token Selection**: Choose from all supported tokens
- **Amount Input**: Enter exact input or output amounts
- **Price Display**: Real-time exchange rates
- **Slippage Settings**: Customize your tolerance
- **Transaction Preview**: Review all details before confirming

### Advanced Settings

Access advanced options by clicking the settings icon:

```typescript
interface SwapSettings {
  slippageTolerance: number;    // Default: 0.5%
  transactionDeadline: number;   // Default: 20 minutes
  expertMode: boolean;           // Default: false
  disableMultihops: boolean;     // Default: false
}
```

## Supported Token Pairs

### Direct Pairs

Direct swaps between tokens with established pools:
- IOTA ↔ stIOTA
- IOTA ↔ USDC
- IOTA ↔ USDT
- And many more...

### Multi-hop Swaps

For tokens without direct pairs, our router automatically finds the best path:

<div style={{
  background: 'rgba(10, 10, 10, 0.8)',
  border: '1px solid rgba(255, 255, 255, 0.1)',
  borderRadius: '8px',
  padding: '16px',
  marginTop: '16px',
  marginBottom: '16px'
}}>
  <strong>Example Route:</strong> Token A → IOTA → USDC → Token B
  
  The router considers:
  - Path efficiency
  - Total fees
  - Price impact
  - Available liquidity
</div>

## Fees and Costs

### Trading Fees

- **Base Fee**: 0.3% of trade value
  - 0.25% to liquidity providers
  - 0.05% to protocol treasury

### Network Fees

- **Gas Costs**: Variable based on network congestion
- **Typically**: 0.001-0.01 IOTA per transaction

### Price Impact

Price impact increases with trade size relative to pool liquidity:

| Trade Size | Typical Impact |
|------------|----------------|
| < $1,000   | < 0.1%        |
| $1,000-10,000 | 0.1%-0.5%   |
| $10,000-100,000 | 0.5%-2%   |
| > $100,000 | > 2%          |

## Slippage Protection

### What is Slippage?

Slippage occurs when the execution price differs from the expected price due to:
- Other trades executing first
- Price movements
- Network delays

### Setting Slippage Tolerance

<div style={{
  background: 'rgba(0, 255, 255, 0.1)',
  border: '1px solid rgba(0, 255, 255, 0.3)',
  borderRadius: '8px',
  padding: '16px',
  marginTop: '16px',
  marginBottom: '16px'
}}>
  <strong>Recommended Settings:</strong>
  
  - **Stable Pairs** (USDC/USDT): 0.1%
  - **Common Pairs** (IOTA/stIOTA): 0.5%
  - **Volatile Pairs**: 1-3%
  - **New Tokens**: 5-10%
</div>

## Smart Routing

Our smart router optimizes every trade by:

1. **Path Finding**: Analyzes all possible routes
2. **Cost Calculation**: Factors in fees and price impact
3. **Split Routing**: Divides large trades across multiple paths
4. **Gas Optimization**: Minimizes transaction costs

### Route Examples

```javascript
// Simple direct swap
IOTA → stIOTA

// Multi-hop for better pricing
IOTA → USDC → WETH → TOKEN

// Split routing for large trades
50% IOTA → stIOTA (Pool 1)
50% IOTA → USDC → stIOTA (Pool 2)
```

## Transaction Safety

### Pre-transaction Checks

Before executing, we verify:
- Sufficient balance
- Approved token allowances
- Valid price quotes
- Network connectivity

### During Transaction

- Real-time status updates
- Automatic retry on failure
- Slippage protection
- MEV protection

### Post-transaction

- Instant balance updates
- Transaction receipt
- Success notification
- Explorer links

## API Integration

Integrate swaps into your application:

```typescript
import { SwapSDK } from '@iota-defi/sdk';

const sdk = new SwapSDK({
  network: 'mainnet',
  slippage: 0.5
});

// Get quote
const quote = await sdk.getQuote({
  tokenIn: 'IOTA',
  tokenOut: 'stIOTA',
  amountIn: '100'
});

// Execute swap
const tx = await sdk.swap({
  tokenIn: 'IOTA',
  tokenOut: 'stIOTA',
  amountIn: '100',
  minAmountOut: quote.minAmountOut,
  recipient: userAddress
});
```

## Best Practices

<div style={{
  background: 'rgba(255, 193, 7, 0.1)',
  border: '1px solid rgba(255, 193, 7, 0.3)',
  borderRadius: '8px',
  padding: '16px',
  marginTop: '16px',
  marginBottom: '16px'
}}>
  <strong>⚡ Pro Tips:</strong>
  
  1. **Check price impact** before large trades
  2. **Use limit orders** for better pricing on size
  3. **Split large trades** to minimize impact
  4. **Monitor gas prices** for optimal timing
  5. **Enable expert mode** only if experienced
</div>

## Troubleshooting

### Common Issues

**"Insufficient Liquidity"**
- Try reducing trade size
- Check if pools exist for your pair
- Consider multi-hop routes

**"Price Impact Too High"**
- Reduce trade amount
- Increase slippage tolerance
- Use limit orders instead

**"Transaction Failed"**
- Check token balances
- Verify allowances
- Increase gas limit
- Try again with higher slippage

## FAQs

**Q: Why did I receive less than expected?**
A: This could be due to price impact, trading fees, or slippage. Always check the minimum received amount before confirming.

**Q: Can I cancel a pending swap?**
A: Once submitted to the blockchain, transactions cannot be cancelled. However, they may fail if conditions aren't met.

**Q: What's the maximum swap size?**
A: There's no hard limit, but larger swaps may experience significant price impact. Consider using limit orders or OTC for very large trades.

**Q: Are swaps reversible?**
A: No, blockchain transactions are irreversible. Always double-check details before confirming.

## Next Steps

- [Learn about providing liquidity →](/core-features/pools)
- [Try limit orders for better pricing →](/core-features/limit-orders)
- [Explore our API documentation →](/api-reference/swap-api)